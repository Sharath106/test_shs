{
  "name": "5f11f17b-37bc-4a51-a640-7874f273f60a",
  "displayName": "BIB_check_Active",
  "form": {
  
  },
  "entryFulfillment": {
    "webhook": "Loyalty",
    "tag": "loyalty_balance",
    "setParameterActions": [ {
      "parameter": "loyalty_balance_checked",
      "value": 0
    } ]
  },
  "transitionRoutes": [ {
    "condition": "$session.params.loyalty_balance[0] != null",
    "triggerFulfillment": {
      "setParameterActions": [ {
        "parameter": "loyalty_balance_count",
        "value": "$sys.func.COUNT($session.params.loyalty_balance)"
      } ]
    },
    "name": "cd635610-b116-4be4-a29f-179afce04975"
  }, {
    "condition": "$session.params.loyalty_balance[0] = null",
    "triggerFulfillment": {
    
    },
    "targetPage": "Bring It Back information",
    "name": "6a5d3cb5-1199-4bc9-bf32-1839b71f43dc"
  }, {
    "condition": "$session.params.loyalty_balance_count \u003e= $session.params.loyalty_balance_checked AND $sys.func.CONTAIN([$session.params.loyalty_balance[$session.params.loyalty_balance_checked]], bringItBack) = true",
    "triggerFulfillment": {
      "setParameterActions": [ {
        "parameter": "bringItBackCount",
        "value": "$sys.func.ADD($session.params.bringItBackCount, 1)"
      }, {
        "parameter": "loyalty_balance_checked",
        "value": "$sys.func.ADD($session.params.loyalty_balance_checked, 1)"
      } ]
    },
    "name": "909e7475-8fde-4fba-96be-8af18badaa24"
  }, {
    "condition": "$session.params.loyalty_balance_count \u003e= $session.params.loyalty_balance_checked AND $sys.func.CONTAIN([$session.params.loyalty_balance[$session.params.loyalty_balance_checked]], easyPayment) = true",
    "triggerFulfillment": {
      "setParameterActions": [ {
        "parameter": "easyPaymentCount",
        "value": "$sys.func.ADD($session.params.easyPaymentCount, 1)"
      }, {
        "parameter": "loyalty_balance_checked",
        "value": "$sys.func.ADD($session.params.loyalty_balance_checked, 1)"
      } ]
    },
    "name": "98c5e9c5-777c-46f6-b28f-89145ece9191"
  }, {
    "condition": "$session.params.loyalty_balance_count \u003e 1 AND $session.params.loyalty_balance[0].balance_type = \"bringItBack\" AND $session.params.loyalty_balance[1].balance_type != \"bringItBack\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "\u003cspeak\u003e\u003cprosody rate=\".80\"\u003eJe vois un Option Retour actif sur votre compte, avec un montant de solde de \u003csay-as interpret-as='currency' language='en-US'\u003e$$session.params.active_loyalty_balance \u003c/say-as\u003e qui se termine le  \u003csay-as interpret-as=\"date\" format=\"\"dd MMMM YYYY\" detail=\"2\"\u003e$session.params.active_loyalty_end_date\u003c/say-as\u003e.\u003c/prosody\u003e\u003c/speak\u003e" ]
        },
        "languageCode": "fr-ca"
      }, {
        "text": {
          "text": [ "\u003cspeak\u003e\u003cprosody rate=\".80\"\u003eI see an active bring it back device in your account. With a balance amount of  \u003csay-as interpret-as='currency' language='en-US'\u003e$$session.params.active_loyalty_balance. which ends on \u003csay-as interpret-as=\"date\" format=\"ymd\" detail=\"2\"\u003e$session.params.active_loyalty_end_date\u003c/say-as\u003e.\u003c/prosody\u003e\u003c/speak\u003e" ]
        },
        "languageCode": "en"
      } ],
      "setParameterActions": [ {
        "parameter": "active_loyalty_balance",
        "value": "$session.params.loyalty_balance[0].amount"
      }, {
        "parameter": "active_loyalty_month_left",
        "value": "$session.params.loyalty_balance[0].months_left"
      }, {
        "parameter": "active_loyalty_monthly_charge",
        "value": "$session.params.loyalty_balance[0].monthly_charge"
      }, {
        "parameter": "loyalty_balance[0].device_name",
        "value": "$session.params.loyalty_balance[0].device_name"
      }, {
        "parameter": "active_loyalty_end_date",
        "value": "\"$sys.func.FORMAT_DATE (\"$session.params.loyalty_balance[0].end_date\" \"dd MMMM YYYY\", \"fr-ca\").\""
      }, {
        "parameter": "active_loyalty_device_type",
        "value": "$session.params.loyalty_balance[0].device_type"
      } ]
    },
    "targetPage": "BIB_Active_Device_info",
    "name": "10c193de-5dd5-4206-bd87-2745ff16859b"
  }, {
    "condition": "$session.params.loyalty_balance_count \u003e 1 AND $session.params.loyalty_balance[1].balance_type = \"bringItBack\" AND $session.params.loyalty_balance[2].balance_type != \"bringItBack\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "\u003cspeak\u003e\u003cprosody rate=\".80\"\u003eJe vois un Option Retour actif sur votre compte, avec un montant de solde de \u003csay-as interpret-as='currency' language='fr-ca'\u003e$$session.params.active_loyalty_balance \u003c/say-as\u003e qui se termine le  \u003csay-as interpret-as=\"date\" format=\"ymd\" language='fr-ca' detail=\"2\"\u003e$session.params.active_loyalty_end_date\u003c/say-as\u003e.\u003c/prosody\u003e\u003c/speak\u003e." ]
        },
        "languageCode": "fr-ca"
      }, {
        "text": {
          "text": [ "\u003cspeak\u003e\u003cprosody rate=\".80\"\u003eI see an active bring it back device in your account. With a balance amount of  \u003csay-as interpret-as='currency' language='en-US'\u003e$$session.params.active_loyalty_balance. which ends on \u003csay-as interpret-as=\"date\" format=\"ymd\" detail=\"2\"\u003e$session.params.active_loyalty_end_date\u003c/say-as\u003e.\u003c/prosody\u003e\u003c/speak\u003e" ]
        },
        "languageCode": "en"
      } ],
      "setParameterActions": [ {
        "parameter": "active_loyalty_balance",
        "value": "$session.params.loyalty_balance[1].amount"
      }, {
        "parameter": "active_loyalty_month_left",
        "value": "$session.params.loyalty_balance[1].months_left"
      }, {
        "parameter": "active_loyalty_monthly_charge",
        "value": "$session.params.loyalty_balance[1].monthly_charge"
      }, {
        "parameter": "loyalty_balance[0].device_name",
        "value": "$session.params.loyalty_balance[1].device_name"
      }, {
        "parameter": "active_loyalty_end_date",
        "value": "$session.params.loyalty_balance[1].end_date"
      }, {
        "parameter": "active_loyalty_device_type",
        "value": "$session.params.loyalty_balance[1].device_type"
      } ]
    },
    "targetPage": "BIB_Active_Device_info",
    "name": "ce929633-7a91-4664-bd3c-dfdc1148d2ef"
  }, {
    "condition": "$session.params.loyalty_balance_count \u003e 1 AND $session.params.loyalty_balance[2].balance_type = \"bringItBack\" AND $session.params.loyalty_balance[3].balance_type != \"bringItBack\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "\u003cspeak\u003e\u003cprosody rate=\".80\"\u003eJe vois un Option Retour actif sur votre compte, avec un montant de solde de \u003csay-as interpret-as='currency' language='en-US'\u003e$$session.params.active_loyalty_balance \u003c/say-as\u003e qui se termine le  \u003csay-as interpret-as=\"date\" format=\"ymd\" detail=\"2\"\u003e$session.params.active_loyalty_end_date\u003c/say-as\u003e.\u003c/prosody\u003e\u003c/speak\u003e." ]
        },
        "languageCode": "fr-ca"
      }, {
        "text": {
          "text": [ "\u003cspeak\u003e\u003cprosody rate=\".80\"\u003eI see an active bring it back device in your account. With a balance amount of  \u003csay-as interpret-as='currency' language='en-US'\u003e$$session.params.active_loyalty_balance. which ends on \u003csay-as interpret-as=\"date\" format=\"ymd\" detail=\"2\"\u003e$session.params.active_loyalty_end_date\u003c/say-as\u003e.\u003c/prosody\u003e\u003c/speak\u003e" ]
        },
        "languageCode": "en"
      } ],
      "setParameterActions": [ {
        "parameter": "active_loyalty_balance",
        "value": "$session.params.loyalty_balance[2].amount"
      }, {
        "parameter": "active_loyalty_month_left",
        "value": "$session.params.loyalty_balance[2].months_left"
      }, {
        "parameter": "active_loyalty_monthly_charge ",
        "value": "$session.params.loyalty_balance[2].monthly_charge"
      }, {
        "parameter": "loyalty_balance[0].device_name ",
        "value": "$session.params.loyalty_balance[2].device_name"
      }, {
        "parameter": "active_loyalty_end_date",
        "value": "$session.params.loyalty_balance[2].end_date"
      }, {
        "parameter": "active_loyalty_device_type",
        "value": "$session.params.loyalty_balance[2].device_type"
      } ]
    },
    "targetPage": "BIB_Active_Device_info",
    "name": "6609794a-84a2-46c2-82af-b05624a42c22"
  }, {
    "condition": "true",
    "triggerFulfillment": {
    
    },
    "targetPage": "Bring It Back information",
    "name": "52a156c6-dd47-4d7e-bc03-e4816c002c19"
  } ],
  "eventHandlers": [ {
    "event": "webhook.error",
    "triggerFulfillment": {
    
    },
    "name": "1fd282cf-5cf2-485d-bb0f-2ff577728262"
  }, {
    "event": "webhook.error.timeout",
    "triggerFulfillment": {
    
    },
    "name": "1def6ac1-053d-41bb-a1c1-778e56d2467a"
  } ]
}
