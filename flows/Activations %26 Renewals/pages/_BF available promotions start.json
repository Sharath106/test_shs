{
  "name": "77981ee9-9784-40e5-a787-114943f151f2",
  "displayName": "_BF available promotions start",
  "form": {
  
  },
  "entryFulfillment": {
    "webhook": "Account Identity",
    "tag": "device_balance_info",
    "setParameterActions": [ {
      "parameter": "sms_flow_status",
      "value": "offered"
    }, {
      "parameter": "phone_number",
      "value": "$session.params.user.utn"
    }, {
      "parameter": "ban",
      "value": "$session.params.user.ban"
    }, {
      "parameter": "last_page",
      "value": "_BF available promotions start"
    } ]
  },
  "transitionRoutes": [ {
    "condition": "$session.params.error_code != null AND $session.params.api_delay = \"false\" AND $session.params.error_retry != \"1\" AND $session.params.balanceInfoList = null",
    "triggerFulfillment": {
      "webhook": "Account Identity",
      "tag": "device_balance_info",
      "setParameterActions": [ {
        "parameter": "error_code",
        "value": null
      }, {
        "parameter": "api_delay",
        "value": null
      }, {
        "parameter": "error_retry",
        "value": "1"
      } ],
      "returnPartialResponses": true
    },
    "name": "9367e2ee-8756-4904-ae56-375c63518396"
  }, {
    "condition": "$session.params.balanceInfoList[0].contractStartTs != null",
    "triggerFulfillment": {
      "setParameterActions": [ {
        "parameter": "contract_day",
        "value": "$sys.func.TO_NUMBER($session.params.balanceInfoList[0].contractStartTs.day)"
      }, {
        "parameter": "contract_month",
        "value": "$sys.func.TO_NUMBER($session.params.balanceInfoList[0].contractStartTs.month)"
      }, {
        "parameter": "contract_year",
        "value": "$sys.func.TO_NUMBER($session.params.balanceInfoList[0].contractStartTs.year)"
      }, {
        "parameter": "jsonContract",
        "value": "{ \"day\": $session.params.contract_day, \"year\": $session.params.contract_year, \"month\": $session.params.contract_month }"
      }, {
        "parameter": "contractDate",
        "value": "$sys.func.TO_OBJECT($session.params.jsonContract)"
      } ]
    },
    "name": "4d7c6b3d-19cd-4254-85b4-8251ae034def",
    "description": "Setting prerequired params"
  }, {
    "condition": "$session.params.route = \"promotions\" AND $session.params.balanceInfoList[0].contractStartTs = null AND $session.params.isEPP = \"false\"",
    "triggerFulfillment": {
    
    },
    "targetPage": "Available promotions",
    "name": "064d6f7f-ed4c-447b-85e5-c78dc36e6e26"
  }, {
    "condition": "$session.params.route = \"promotions\" AND $sys.func.IS_PAST_DATE($sys.func.ADD_DATE($session.params.contractDate, 16, \"DAYS\")) = false AND $session.params.isEPP = \"false\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "I notice you've recently purchased or upgraded your device. If you're looking for a rate plan or offer change, you can request this online at telus.com. Please note, you must meet the specific eligibility requirements of the offer you are requesting and you must be within your return period. I will send you a text with more information on how to request this new offer." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Je vois que vous avez récemment acheté ou renouveler votre appareil. Si vous voulez changer de forfait ou d'offre, vous pouvez en faire la demande en ligne à telus.com. Notez que vous devez répondre aux conditions d'éligibilité spécifiques à l'offre que vous demandez et vous devez être dans votre période de retour. Je vais vous envoyer un texte avec plus d'informations sur la façon de demander cette nouvelle offre." ]
        },
        "languageCode": "fr-ca"
      } ],
      "setParameterActions": [ {
        "parameter": "sms_template",
        "value": "000BAaJM29TN0104"
      }, {
        "parameter": "sms_template_fr",
        "value": "000BAaJM29TN0107"
      }, {
        "parameter": "mandatory_ss",
        "value": "true"
      } ]
    },
    "targetFlow": "SMS Flow",
    "name": "d27056fd-c549-4a0c-9e61-f8f332c368d7"
  }, {
    "condition": "$session.params.route = \"promotions\" OR $session.params.isEPP = \"false\"",
    "triggerFulfillment": {
    
    },
    "targetPage": "Available promotions",
    "name": "4e42238e-e73f-4df5-b2ff-cb727d228f1b"
  } ]
}
