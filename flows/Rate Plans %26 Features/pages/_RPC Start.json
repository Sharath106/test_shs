{
  "name": "d1f1fdb8-73c4-4d62-9805-43edc7cf009c",
  "displayName": "_RPC Start",
  "form": {
    "parameters": [ {
      "displayName": "phone_number",
      "required": true,
      "entityType": "@sys.phone-number",
      "fillBehavior": {
        "initialPromptFulfillment": {
        
        },
        "repromptEventHandlers": [ {
          "event": "sys.no-match-1",
          "triggerFulfillment": {
            "messages": [ {
              "text": {
                "text": [ "Ça ne semble pas être un numéro valide. Veuillez entrer votre numéro de téléphone à 10 chiffres.", "Ceci n'est pas un numéro de téléphone. Entrez un numéro valide pour continuer." ]
              },
              "languageCode": "fr-ca"
            } ],
            "conditionalCases": [ {
              "cases": [ {
                "condition": "$session.params.phoneNumberCount \u003c 5"
              }, {
              
              } ]
            } ]
          },
          "name": "dbda89f5-56be-42b0-b231-651daa087b57"
        }, {
          "targetPage": "No Match 2",
          "event": "sys.no-match-2",
          "triggerFulfillment": {
          
          },
          "name": "b1eaf7ad-2ab7-4bb5-9aa2-b42177dbd24e"
        } ]
      },
      "advancedSettings": {
        "dtmfSettings": {
          "useSystemEntityRule": false
        }
      }
    } ]
  },
  "entryFulfillment": {
    "webhook": "Account Identity",
    "tag": "get_phone_numbers",
    "setParameterActions": [ {
      "parameter": "valid_phone_number",
      "value": null
    }, {
      "parameter": "last_page",
      "value": "_RPC Start"
    } ],
    "conditionalCases": [ {
      "cases": [ {
        "condition": "$session.params.no_account = true",
        "caseContent": [ {
          "message": {
            "text": {
              "text": [ "I can't find any accounts associated to your profile." ]
            },
            "languageCode": "en"
          }
        }, {
          "message": {
            "text": {
              "text": [ "Je ne trouve aucun compte associé à votre profil." ]
            },
            "languageCode": "fr-ca"
          }
        } ]
      }, {
        "condition": "$session.params.invalid_number_counter = null",
        "caseContent": [ {
          "message": {
            "text": {
              "text": [ "I can help you change your rate plan." ]
            },
            "languageCode": "en"
          }
        }, {
          "message": {
            "text": {
              "text": [ "Je peux vous aider à changer votre forfait." ]
            },
            "languageCode": "fr-ca"
          }
        } ]
      } ]
    } ]
  },
  "transitionRoutes": [ {
    "intent": "supplemental.num_notonlist",
    "condition": "$session.params.no_find_phone_number = null",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "If your number is not on the list, and you have another My TELUS profile, please log out and start another session using correct credentials" ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Désolé d'apprendre que vous ne voyez pas votre numéro de téléphone." ]
        },
        "languageCode": "fr-ca"
      }, {
        "text": {
          "text": [ "Si vous avez un autre profil Mon TELUS, veuillez vous déconnecter et commencer une nouvellle session." ]
        },
        "languageCode": "fr-ca"
      } ],
      "setParameterActions": [ {
        "parameter": "no_find_phone_number",
        "value": "true"
      } ]
    },
    "targetPage": "End Page",
    "name": "9d947e3a-2e01-4905-a45b-454a9e7066f6"
  }, {
    "intent": "supplemental.num_notonlist",
    "condition": "$session.params.no_find_phone_number = true",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Let me get you to an agent in this case." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Laissez-moi vous mettre en contact avec un agent dans ce cas." ]
        },
        "languageCode": "fr-ca"
      } ]
    },
    "targetFlow": "Universal handoff",
    "name": "daa2da6a-00a6-47e4-a3b2-8f1b5e83b62c"
  }, {
    "intent": "small_talk.confirmation_yes",
    "condition": "$session.params.phone_number != null AND $session.params.phoneNumberCount != \"1\"",
    "triggerFulfillment": {
    
    },
    "targetPage": "_RPC Account validation",
    "name": "284dbd4c-e3de-4c85-a7f2-04d9e2f9e0d1"
  }, {
    "intent": "small_talk.confirmation_no",
    "condition": "$session.params.phone_number != null AND $session.params.phoneNumberCount != \"1\"",
    "triggerFulfillment": {
      "setParameterActions": [ {
        "parameter": "phone_number",
        "value": null
      }, {
        "parameter": "phone_number_counter",
        "value": null
      } ]
    },
    "targetPage": "Current Page",
    "name": "266e3234-8834-46fd-bb5a-adc171077d92"
  }, {
    "intent": "small_talk.confirmation_yes",
    "condition": "$session.params.phoneNumberCount = \"1\"",
    "triggerFulfillment": {
      "webhook": "Account Identity",
      "tag": "selected_phone_number",
      "setParameterActions": [ {
        "parameter": "phone_number",
        "value": "$session.params.filtered_phoneNumbers[0]"
      }, {
        "parameter": "phone_number_counter",
        "value": "1"
      } ]
    },
    "targetPage": "_RPC Account validation",
    "name": "2c0336b4-ae4f-4b8d-bd4c-bc2f4b7c277c"
  }, {
    "intent": "small_talk.confirmation_no",
    "condition": "$session.params.phoneNumberCount = \"1\" AND $session.params.no_find_phone_number = null",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "I can't seem to find any other phone numbers associated with your profile. " ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "If you have another My TELUS profile, please log out and start a new session using the correct credentials." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Je ne semble pas trouver d'autre numéro de téléphone associé à votre profil." ]
        },
        "languageCode": "fr-ca"
      }, {
        "text": {
          "text": [ "Si vous avez un autre profil Mon TELUS, veuillez vous déconnecter et commencer une nouvelle session en utilisant le bon profil." ]
        },
        "languageCode": "fr-ca"
      } ],
      "setParameterActions": [ {
        "parameter": "no_find_phone_number",
        "value": "true"
      } ]
    },
    "name": "93ba9641-66cf-4db7-a27e-77ddb96c051a"
  }, {
    "intent": "small_talk.confirmation_no",
    "condition": "$session.params.phoneNumberCount = \"1\" AND $session.params.no_find_phone_number = \"true\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "I still can't find the phone number you're inquiring about, let me get you to an agent." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Je ne trouve toujours pas ce numéro de téléphone, je peux vous mettre en contact avec un agent." ]
        },
        "languageCode": "fr-ca"
      } ]
    },
    "targetFlow": "Universal handoff",
    "name": "e6cdae21-c289-427f-81ce-169977b9c426"
  }, {
    "condition": "$session.params.out_of_scope_ffh = \"true\" OR $session.params.filtered_phoneNumbers[0] = null",
    "triggerFulfillment": {
    
    },
    "targetPage": "Rate plan change",
    "name": "890c07fe-dea8-4fa1-acd9-7945faa11629"
  }, {
    "condition": "$session.params.error_code != null AND $session.params.api_delay = \"false\" AND $session.params.error_retry != \"1\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "⏳ Please wait, I am still working on your request." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "⏳ Veuillez patientez pendant que j'accède à vos informations." ]
        },
        "languageCode": "fr-ca"
      } ],
      "setParameterActions": [ {
        "parameter": "error_code",
        "value": null
      }, {
        "parameter": "error_retry",
        "value": "1"
      }, {
        "parameter": "api_delay",
        "value": null
      }, {
        "parameter": "error_full_response",
        "value": null
      }, {
        "parameter": "error_api_name",
        "value": null
      } ],
      "returnPartialResponses": true
    },
    "targetPage": "Current Page",
    "name": "8cbf5ba9-59cc-4795-b1bc-aa7e5277b6ea"
  }, {
    "condition": "($session.params.error_code != null AND $session.params.error_retry = \"1\") OR ($session.params.api_delay = \"true\" AND $session.params.error_code != null)",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Sorry, I am having issues with your request." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Désolé, j'ai un problème avec votre demande." ]
        },
        "languageCode": "fr-ca"
      } ],
      "setParameterActions": [ {
        "parameter": "error_retry",
        "value": null
      }, {
        "parameter": "error_code",
        "value": null
      }, {
        "parameter": "api_delay",
        "value": null
      }, {
        "parameter": "error_full_response",
        "value": null
      }, {
        "parameter": "error_api_name",
        "value": null
      } ]
    },
    "targetPage": "Rate plan change",
    "name": "14a20821-69b3-4017-8078-402db8f2d4dc"
  }, {
    "condition": "($session.params.phone_number != null AND $session.params.phone_number_counter != 1) OR ($session.params.phone_number_counter = 1 AND $session.params.phoneNumberCount = 1)",
    "triggerFulfillment": {
      "webhook": "Account Identity",
      "tag": "selected_phone_number",
      "setParameterActions": [ {
        "parameter": "phone_number_counter",
        "value": "1"
      } ]
    },
    "targetPage": "_RPC Account validation",
    "name": "44455c36-86d0-43b3-9ffe-64a03f582ca4"
  }, {
    "condition": "$session.params.phone_number_counter != \"1\" AND $session.params.phoneNumberCount = 1",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Is $session.params.filtered_phoneNumbers[0] the phone number you are inquiring about?" ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Le $session.params.filtered_phoneNumbers[0] est-il le numéro de téléphone auquel vous souhaitez vous renseigner?" ]
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "006c3646-4e7b-47b8-bd45-d4ae8416fd1a"
  }, {
    "condition": "$session.params.phone_number != null AND $session.params.phone_number_counter = \"1\"",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Is $session.params.phone_number still the phone number you're inquiring about?" ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Est-ce que votre demande est toujours par rapport au numéro de téléphone $session.params.phone_number?" ]
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "857a1fe6-0130-44d8-9a02-168530ab67f0"
  }, {
    "condition": "$session.params.phoneNumberCount = \"2\" AND $session.params.phone_number = null",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Which phone number are you inquiring about?" ]
        },
        "languageCode": "en"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            } ]
          }
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Votre demande est par rapport à quel numéro de téléphone?" ]
        },
        "languageCode": "fr-ca"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            } ]
          }
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "d7083604-dcbb-4fcf-b84e-2a6a2794d30d"
  }, {
    "condition": "$session.params.phoneNumberCount = \"3\" AND $session.params.phone_number = null",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Which phone number are you inquiring about?" ]
        },
        "languageCode": "en"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[2]",
              "text": "$session.params.filtered_phoneNumbers[2]"
            } ]
          }
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Votre demande est par rapport à quel numéro de téléphone?" ]
        },
        "languageCode": "fr-ca"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[2]",
              "text": "$session.params.filtered_phoneNumbers[2]"
            } ]
          }
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "4a584c6d-0c0e-4ee2-8530-dc781609171e"
  }, {
    "condition": "$session.params.phoneNumberCount = \"4\" AND $session.params.phone_number = null",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Which phone number are you inquiring about?" ]
        },
        "languageCode": "en"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[2]",
              "text": "$session.params.filtered_phoneNumbers[2]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[3]",
              "text": "$session.params.filtered_phoneNumbers[3]"
            } ]
          }
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Votre demande est par rapport à quel numéro de téléphone?" ]
        },
        "languageCode": "fr-ca"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[2]",
              "text": "$session.params.filtered_phoneNumbers[2]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[3]",
              "text": "$session.params.filtered_phoneNumbers[3]"
            } ]
          }
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "fba81609-1ec5-415d-861b-5c02b10db2fb"
  }, {
    "condition": "$session.params.phoneNumberCount = \"5\" AND $session.params.phone_number = null",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Which phone number are you inquiring about?" ]
        },
        "languageCode": "en"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[2]",
              "text": "$session.params.filtered_phoneNumbers[2]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[3]",
              "text": "$session.params.filtered_phoneNumbers[3]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[4]",
              "text": "$session.params.filtered_phoneNumbers[4]"
            } ]
          }
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Votre demande est par rapport à quel numéro de téléphone?" ]
        },
        "languageCode": "fr-ca"
      }, {
        "payload": {
          "quickReplies": {
            "replies": [ {
              "responsePayload": "$session.params.filtered_phoneNumbers[0]",
              "text": "$session.params.filtered_phoneNumbers[0]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[1]",
              "text": "$session.params.filtered_phoneNumbers[1]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[2]",
              "text": "$session.params.filtered_phoneNumbers[2]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[3]",
              "text": "$session.params.filtered_phoneNumbers[3]"
            }, {
              "responsePayload": "$session.params.filtered_phoneNumbers[4]",
              "text": "$session.params.filtered_phoneNumbers[4]"
            } ]
          }
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "6eb0e919-41d5-4960-81ea-5b0d4727f942"
  }, {
    "condition": "$session.params.phoneNumberCount \u003e \"5\" AND $session.params.phone_number = null",
    "triggerFulfillment": {
      "conditionalCases": [ {
        "cases": [ {
          "condition": "$session.params.invalid_number_counter = 1",
          "caseContent": [ {
            "message": {
              "text": {
                "text": [ "What phone number are you inquiring about?" ]
              },
              "languageCode": "en"
            }
          }, {
            "message": {
              "text": {
                "text": [ "Votre demande est par rapport à quel numéro de téléphone?" ]
              },
              "languageCode": "fr-ca"
            }
          } ]
        }, {
          "caseContent": [ {
            "message": {
              "text": {
                "text": [ "It looks like you have many phone numbers associated to your profile." ]
              },
              "languageCode": "en"
            }
          }, {
            "message": {
              "text": {
                "text": [ "What phone number are you inquiring about?" ]
              },
              "languageCode": "en"
            }
          }, {
            "message": {
              "text": {
                "text": [ "Vous semblez avoir plusieurs numéros de téléphone associés à votre profil." ]
              },
              "languageCode": "fr-ca"
            }
          }, {
            "message": {
              "text": {
                "text": [ "Votre demande est par rapport à quel numéro de téléphone?" ]
              },
              "languageCode": "fr-ca"
            }
          } ]
        } ]
      } ]
    },
    "name": "a7be61b7-42b6-49eb-8117-d92c5cca0381"
  } ],
  "eventHandlers": [ {
    "targetPage": "Rate plan change",
    "event": "webhook.error",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Sorry, I am having issues with your request." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Désolé, j'ai des problèmes avec votre demande." ]
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "ed0ebbe9-ee2f-4adc-926f-b81dd2549c5c"
  }, {
    "targetPage": "Rate plan change",
    "event": "webhook.error.timeout",
    "triggerFulfillment": {
      "messages": [ {
        "text": {
          "text": [ "Sorry, I am having issues with your request." ]
        },
        "languageCode": "en"
      }, {
        "text": {
          "text": [ "Désolé, j'ai des problèmes avec votre demande." ]
        },
        "languageCode": "fr-ca"
      } ]
    },
    "name": "bf211feb-ec22-4870-b319-515583f5a9ae"
  } ]
}
